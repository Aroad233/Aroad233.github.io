<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="并发业务处理记录"><meta name="keywords" content="php,laravel,mysql,redis"><meta name="author" content="Aroad阿路"><meta name="copyright" content="Aroad阿路"><title>并发业务处理记录 | 阿路胡言乱语的小栈</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E4%B8%9A%E5%8A%A1%E5%A4%84%E7%90%86%E8%AE%B0%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">并发业务处理记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%99%AF%E6%8F%90%E8%A6%81"><span class="toc-number">1.1.</span> <span class="toc-text">前景提要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.</span> <span class="toc-text">场景说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E6%83%85%E5%86%B5"><span class="toc-number">1.2.1.</span> <span class="toc-text">并发情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.</span> <span class="toc-text">解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E8%A7%A3%E5%86%B3%E5%88%86%E6%9E%90"><span class="toc-number">1.3.1.</span> <span class="toc-text">实际解决分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%AD%90%E9%94%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.2.</span> <span class="toc-text">原子锁实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E9%A2%86%E5%8F%96%E5%A5%96%E5%8A%B1"><span class="toc-number">1.3.3.</span> <span class="toc-text">手动领取奖励</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%A2%86%E5%8F%96%E5%A5%96%E5%8A%B1"><span class="toc-number">1.3.4.</span> <span class="toc-text">自动领取奖励</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%88%E8%B0%88%E5%85%B6%E4%BB%96%E8%A7%A3%E5%86%B3%E5%B9%B6%E5%8F%91%E7%9A%84%E6%96%B9%E6%A1%88"><span class="toc-number">1.4.</span> <span class="toc-text">谈谈其他解决并发的方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">1.4.1.</span> <span class="toc-text">乐观锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">版本控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E6%9B%B4%E6%96%B0%E5%90%8E%E6%88%90%E5%8A%9F"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">后更新后成功</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#more"><span class="toc-number">1.4.2.</span> <span class="toc-text">more</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://aroad.top/demo/avagar.jpg"></div><div class="author-info__name text-center">Aroad阿路</div><div class="author-info__description text-center">一个phper</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">7</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">8</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">1</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://leckkk.github.io">194单身青年</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://aroad.top/demo/banner2.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">阿路胡言乱语的小栈</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">并发业务处理记录</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-12-14</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="并发业务处理记录"><a href="#并发业务处理记录" class="headerlink" title="并发业务处理记录"></a>并发业务处理记录</h1><h2 id="前景提要"><a href="#前景提要" class="headerlink" title="前景提要"></a>前景提要</h2><p>公司项目涉及到任务模块的奖励发放，跟黑产开始斗智斗勇了所以涉及到了并发的情况。</p>
<h2 id="场景说明"><a href="#场景说明" class="headerlink" title="场景说明"></a>场景说明</h2><p>目前我涉及到的任务就两种，签到、邀新邀老助力，任务配置包括奖励自动发放与手动发放。其余略。</p>
<h3 id="并发情况"><a href="#并发情况" class="headerlink" title="并发情况"></a>并发情况</h3><p>用户短时间多次请求接口导致多次任务奖励的发放</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li>mysql锁表</li>
<li>redis原子锁</li>
</ol>
<h3 id="实际解决分析"><a href="#实际解决分析" class="headerlink" title="实际解决分析"></a>实际解决分析</h3><ol>
<li>mysql锁表简单粗暴，适合当前的业务量需求，立马能写完。我也想这样解决，然后给打回来重做了。</li>
<li>redis原子锁 速度快，减少db负载</li>
</ol>
<h3 id="原子锁实现"><a href="#原子锁实现" class="headerlink" title="原子锁实现"></a>原子锁实现</h3><p>先自己翻阅资料尝试了第一版的原子锁</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">static</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">redisTran</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span>,<span class="keyword">int</span> <span class="variable">$expire</span>,<span class="built_in">Closure</span> <span class="variable">$func</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Redis::set(<span class="variable">$key</span>,<span class="number">1</span>,<span class="string">&#x27;ex&#x27;</span>,<span class="variable">$exprie</span>,<span class="string">&#x27;nx&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$func</span>();</span><br><span class="line">            <span class="comment">//解锁</span></span><br><span class="line">            Redis::del(<span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>当时的想法</p>
<h3 id="手动领取奖励"><a href="#手动领取奖励" class="headerlink" title="手动领取奖励"></a>手动领取奖励</h3><p>很简单 <code>$key</code>用<code>userId</code>+任务<code>id</code>就行了</p>
<h3 id="自动领取奖励"><a href="#自动领取奖励" class="headerlink" title="自动领取奖励"></a>自动领取奖励</h3><p>任务进度推进后判断任务是否完成以及任务是否自动发放奖励，是的话触发奖励发放事件，否的话等着手动领取。</p>
<p>这里的话我后来扔到了观察者里面去触发自动奖励的发放</p>
<p>问题而后其他的问题就来了，自动奖励发放锁奖励发放这个事件还是锁任务推进这个事件，最开始尝试过锁奖励发放，但存在一个问题，用户邀请用户存在一时间多个用户帮助助力的并发，但同时也存在一个用户多次助力用户的并发请求。</p>
<ol>
<li>保证所有的助力与邀请任务都可以被触发</li>
<li>防止恶意并发存在的多次奖励领取与发放</li>
</ol>
<p>问题1可以使用队列解决，问题2可以使用原子锁解决通过<code>key</code>去区分</p>
<p>而后经过了一定的codereview</p>
<p>重新实现原子锁</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Utils</span>\<span class="title">Lock</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Exceptions</span>\<span class="title">BusinessException</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Exception</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Redis</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Throwable</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lock</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> <span class="variable">$lockName</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$instance</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;lockName = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getLock</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span></span>): <span class="title">Lock</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="built_in">self</span>::<span class="variable">$instance</span> <span class="keyword">instanceof</span> <span class="built_in">self</span>)) &#123;</span><br><span class="line">            <span class="built_in">self</span>::<span class="variable">$instance</span> = <span class="keyword">new</span> <span class="built_in">self</span>(<span class="variable">$key</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">self</span>::<span class="variable">$instance</span>-&gt;lockName = <span class="variable">$key</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$instance</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> callable $callback</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $expireTime</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">synchronized</span> (<span class="params"><span class="keyword">callable</span> <span class="variable">$callback</span>, <span class="keyword">int</span> <span class="variable">$expireTime</span> = <span class="number">600</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;tryLock(<span class="variable">$expireTime</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$callback</span>();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="built_in">Throwable</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="variable">$e</span>;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;<span class="subst">&#123;$this-&gt;lockName&#125;</span> lock fail, try it later&quot;</span>, <span class="number">0xF0106801</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tryLock</span>(<span class="params"><span class="variable">$expireTime</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Redis::set(<span class="keyword">$this</span>-&gt;lockName,<span class="number">1</span>,<span class="string">&#x27;EX&#x27;</span>,<span class="variable">$expireTime</span>,<span class="string">&#x27;NX&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unlock</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Redis::del(<span class="keyword">$this</span>-&gt;lockName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而后所有自动发放的任务在任务推动时增加锁 即可解决并发问题，具体的<code>$key</code>根据对应的业务决定</p>
<hr>
<h2 id="谈谈其他解决并发的方案"><a href="#谈谈其他解决并发的方案" class="headerlink" title="谈谈其他解决并发的方案"></a>谈谈其他解决并发的方案</h2><p>昨日跟其他人聊到并发的情况，聊到了其他场景的并发情况</p>
<h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><h4 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h4><p>其实也就是mysql的increment，或者是其他的标记也行，常见的是版本控制</p>
<p>这里举个例子说明</p>
<p><code>select (num,version) from orders where id = 1;</code></p>
<p>每次查询时将标记也一并取出 ，假设<code>version</code> 为1;</p>
<p><code>update orders set num = num+1,version=version+1 where id = 1 and version = 1 </code></p>
<p>如果在这句话之前version先一步被其他语句更新为2，那么以上语句就不会更新</p>
<p>当然不同场景也需要控制不同的锁粒度</p>
<h4 id="后更新后成功"><a href="#后更新后成功" class="headerlink" title="后更新后成功"></a>后更新后成功</h4><p>只会更新一次时，比如一时间只会扣款一次。先生成一个标记存入表中，而后<code>update</code>时<code>where</code>带上这个标记，同时多个并发修改时谁后更新进去谁就成功。</p>
<h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><p>待填坑</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Aroad阿路</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://aroad233.github.io/2021/12/14/并发记录/">http://aroad233.github.io/2021/12/14/并发记录/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://aroad233.github.io">阿路胡言乱语的小栈</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/php/">php</a><a class="post-meta__tags" href="/tags/laravel/">laravel</a><a class="post-meta__tags" href="/tags/mysql/">mysql</a><a class="post-meta__tags" href="/tags/redis/">redis</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/06/26/laravel-autoload/"><i class="fa fa-chevron-left">  </i><span>laravel-autoload</span></a></div><div class="next-post pull-right"><a href="/2021/09/23/%E5%AF%B9laravel%E8%AE%B0%E5%BD%95ip%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"><span>对laravel记录ip的一些思考</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://aroad.top/demo/banner2.png)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By Aroad阿路</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>